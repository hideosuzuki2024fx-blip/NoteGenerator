<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>NoteGenerator Relay Bridge (Test Mode)</title>
</head>
<body>
<h3>NoteGenerator Relay Bridge</h3>
<pre id="output">Running test...</pre>

<script>
(async () => {
  const output = document.getElementById("output");

  // --- â‘  URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾— ---
  const params = new URLSearchParams(window.location.search);
  const message = params.get("message") || "Test from Relay HTML";
  output.textContent = `Message received: "${message}"`;

  // --- â‘¡ GitHub APIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ§‹æˆ ---
  const GITHUB_TOKEN = "ghp_ã‚ãªãŸã®ãƒ†ã‚¹ãƒˆç”¨PATã‚’ã“ã“ã«è²¼ã‚‹"; // â†ãƒ†ã‚¹ãƒˆå°‚ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥ã‚Œã‚‹
  const owner = "hideosuzuki2024fx-blip";
  const repo = "NoteGenerator";
  const path = `logs/relay/relay_log_${Date.now()}.txt`;

  const body = {
    message: `ğŸ›°ï¸ Relay Test Commit: ${message}`,
    content: btoa(`Relay executed at ${new Date().toISOString()}\nMessage: ${message}`)
  };

  try {
    const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
      method: "PUT",
      headers: {
        "Authorization": `Bearer ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github+json"
      },
      body: JSON.stringify(body)
    });

    if (!res.ok) {
      const err = await res.text();
      output.textContent = `âŒ Failed (${res.status}): ${err}`;
      return;
    }

    const data = await res.json();
    output.textContent = `âœ… Success! Log pushed to ${data.content.path}`;
  } catch (err) {
    output.textContent = `âš ï¸ Error: ${err.message}`;
  }
})();
</script>
</body>
</html>
