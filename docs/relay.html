<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>NoteGenerator Relay Bridge (Safe Encoded)</title>
</head>
<body>
<h3>NoteGenerator Relay Bridge (Safe Mode)</h3>
<pre id="output">Running test...</pre>

<script>
(async () => {
  const output = document.getElementById("output");

  const params = new URLSearchParams(window.location.search);
  const messageRaw = params.get("message") || "Relay Test";
  const message = decodeURIComponent(messageRaw);
  output.textContent = `Message received: "${message}"`;

  // ğŸ‘‡ ãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒ†ã‚¹ãƒˆç”¨ã®ã¿ã«
  const GITHUB_TOKEN = "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";
  const owner = "hideosuzuki2024fx-blip";
  const repo = "NoteGenerator";
  const path = `logs/relay/relay_log_${Date.now()}.txt`;

  // ğŸ§  JSONæ–‡å­—åˆ—ã«çµµæ–‡å­—ãŒå«ã¾ã‚Œã¦ã‚‚å®‰å…¨ã«æ‰±ãˆã‚‹ã‚ˆã†ã«Base64åŒ–
  const contentText = `Relay executed at ${new Date().toISOString()}\nMessage: ${message}`;
  const body = {
    message: `Relay Test Commit`,
    content: btoa(unescape(encodeURIComponent(contentText))) // UTF-8â†’Base64
  };

  try {
    const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
      method: "PUT",
      headers: {
        "Authorization": `Bearer ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github+json"
      },
      body: JSON.stringify(body)
    });

    if (!res.ok) {
      const err = await res.text();
      output.textContent = `âŒ Failed (${res.status}): ${err}`;
      return;
    }

    const data = await res.json();
    output.textContent = `âœ… Success! Log pushed to ${data.content.path}`;
  } catch (err) {
    output.textContent = `âš ï¸ Error: ${err.message}`;
  }
})();
</script>
</body>
</html>
