name: NoteGenerator Relay
on:
  workflow_dispatch:
    inputs:
      message:
        description: "Trigger message from Ponta or GPT workflow"
        required: false
        default: "Manual relay trigger"
  push:
    paths:
      - "articles/**"
      - "docs/**"
      - "knowledge/**"
jobs:
  commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup environment
        run: |
          echo "Setting up environment for Note Generator"
          git config --global user.name "PONTA Bot"
          git config --global user.email "ponta-bot@notegen.system"

      - name: Process staged files
        run: |
          echo "Checking modified files..."
          git status
          echo "Preparing Base64 encoding and SHA verification..."

      - name: Encode and commit
        run: |
          for f in $(git ls-files -m); do
            echo "Processing $f ..."
            sha=$(git hash-object $f)
            base64=$(base64 -w 0 $f)
            echo "SHA: $sha"
            echo "Base64 conversion done for $f"
            git add "$f"
          done
          git commit -m "${github.event.inputs.message}"
          git push origin main
