name: gpt-read-simulation

on:
  push:
    branches: [ "main" ]
  pull_request:

jobs:
  simulate-gpt-read:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Simulate GPT raw reading
        shell: bash
        run: |
          set -e

          urls=(
            "https://raw.githubusercontent.com//main/NoteGenerator.spec.md"
            "https://raw.githubusercontent.com//main/knowledge_manifest.json"
            "https://raw.githubusercontent.com//main/gpt/allowlist.json"
            "https://raw.githubusercontent.com//main/NoteMD/config/init_context.json"
            "https://raw.githubusercontent.com//main/NoteMD/meta/taxonomy.json"
            "https://raw.githubusercontent.com//main/NoteMD/meta/catalog.json"
            "https://raw.githubusercontent.com//main/NoteMD/meta/NAV.md"
            "https://raw.githubusercontent.com//main/NoteMD/meta/thread_state.md"
          )

          mkdir -p gpt_read

          for u in "\"; do
            echo "GPT GET: \"
            curl -fLsS "\" -o gpt_read/
          done

          echo "Parsing JSON as GPT would"
          python3 - << 'PY'
          import json

          for f in [
            "knowledge_manifest.json",
            "allowlist.json",
            "init_context.json",
            "taxonomy.json",
            "catalog.json"
          ]:
            path = "gpt_read/" + f
            with open(path, encoding="utf-8") as fp:
              json.load(fp)
          print("OK: GPT can read and parse all required files")
          PY
